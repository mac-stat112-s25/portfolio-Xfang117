---
title: "Exam 2"
format: html
---

1.load package
```{r}
library(tidytuesdayR)
library(tidyverse)
library(rnaturalearth)
library(sf)
tuesdata<-tt_load('2020-02-18')
fc<-tuesdata$food_consumption
```



5. Fix the categroy variable
```{r}
library(dplyr)

fc <- fc %>%
  mutate(food_category = case_when(
    food_category == "Lamb & Goat" ~ "Lamb",
    food_category == "Milk - inc. cheese" ~ "Milk",
    food_category == "Wheat and Wheat Products" ~ "Wheat",
    food_category == "Nuts inc. Peanut Butter" ~ "Nuts",
    TRUE ~ food_category  # 默认保留其他未列出的原始名称
  ))

```
6. Research question 1 waht are the most consume countries

```{r}
top5_countries <- fc %>%
  group_by(country) %>%
  summarise(total_consumption = sum(consumption, na.rm = TRUE)) %>%
  arrange(desc(total_consumption)) %>%
  slice_head(n = 5)

top5_countries


ggplot(top5_countries, aes(x = reorder(country, total_consumption), y = total_consumption, fill = country)) +
  geom_col() +
  coord_flip() +  # Horizontal bar chart for readability
  labs(
    title = "Top 5 Countries by Total Food Consumption",
    x = "Country",
    y = "Total Consumption"
  ) +
  theme_minimal() +
  theme(legend.position = "none")

```


7. Research question 2 waht are the most consuming countries of each food
```{r}
library(dplyr)

top_country_per_food <- fc %>%
  group_by(food_category, country) %>%
  summarise(total_consumption = sum(consumption, na.rm = TRUE), .groups = "drop_last") %>%
  slice_max(order_by = total_consumption, n = 1, with_ties = FALSE) %>%
  ungroup()

top_country_per_food

ggplot(top_country_per_food, aes(x = total_consumption, y = reorder(food_category, total_consumption), color = country)) +
  geom_point(size = 4) +
  geom_segment(aes(x = 0, xend = total_consumption, y = food_category, yend = food_category), color = "gray") +
  labs(
    title = "Top Consuming Country for Each Food Category",
    x = "Consumption",
    y = "Food Category",
    color = "Country"
  ) +
  theme_minimal(base_size = 12)

```


8. Research question 3 what is the consumption for each food
```{r}
library(dplyr)

food_consumption_per_country <- fc %>%
  group_by(food_category, country) %>%
  summarise(total_consumption = sum(consumption, na.rm = TRUE), .groups = "drop")

food_consumption_per_country

ggplot(food_consumption_per_country, aes(x = reorder(food_category, total_consumption), y = total_consumption)) +
  geom_col(fill = "steelblue") +
  coord_flip() +
  labs(
    title = "Total Global Consumption by Food Category",
    x = "Food Category",
    y = "Total Consumption"
  ) +
  theme_minimal(base_size = 12)

```


11. Food consumption statistics

```{r}
library(dplyr)

consumption_stats <- fc %>%
  group_by(food_category) %>%
  summarise(
    min_consumption = min(consumption, na.rm = TRUE),
    max_consumption = max(consumption, na.rm = TRUE),
    range_consumption = max_consumption - min_consumption
  )

consumption_stats

```
